name: Guardioes do Codigo (CI)

on:
  push:
    branches: [ "main", "master", "feature/*", "ci/*", "refactor/*" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  testes-automatizados:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Baixando o repositÃ³rio
      uses: actions/checkout@v4

    - name: ğŸ Configurando Python 3.13
      uses: actions/setup-python@v5
      with:
        python-version: "3.13"

    - name: ğŸ“¦ Instalando dependÃªncias
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        pip install pytest pandas openpyxl

    - name: ğŸ“ Criando estrutura de pastas
      run: |
        mkdir -p output
        mkdir -p output-dashboard
        mkdir -p raw_data_local
        mkdir -p configs

    - name: âš™ï¸ Gerando configuraÃ§Ã£o temporÃ¡ria
      run: |
        echo "ANO_DO_RELATORIO = 2025" > configs/settings_local.py
        echo "MES_DO_RELATORIO = 11" >> configs/settings_local.py
        echo "CAMINHOS = {'local': {'input': 'raw_data_local', 'output': 'output'}}" >> configs/settings_local.py

    - name: ğŸ§ª Rodando os GuardiÃµes (Pytest)
      run: |
        pytest tests/